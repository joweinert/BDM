from util.delta_storage import DeltaStorageHandler
import os

bucket = os.environ["EXPLOITATION_ZONE_BUCKET"]
handler = DeltaStorageHandler(storage_path="Trusted_Zone")
tables = handler.list_tables()


for delta_path in tables:
    df = handler.read_table(delta_path)
    name = "_".join([delta_path.split("/")[-2], delta_path.split("/")[-1]])

    df.write.mode("overwrite").parquet(f"s3a://exploitation-zone/_staging_parquet/{name}")
    # picked up by ddb setup
